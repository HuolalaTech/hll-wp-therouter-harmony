"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MergeErrorList=void 0;const ErrorLogConsts_js_1=require("../../consts/ErrorLogConsts.js"),HvigorErrorInfo_js_1=require("../../logger/HvigorErrorInfo.js"),CreateGroupByCause_js_1=require("./CreateGroupByCause.js"),CreateGroupByCode_js_1=require("./CreateGroupByCode.js"),CreateGroupByMoreInfo_js_1=require("./CreateGroupByMoreInfo.js"),CreateGroupByPosition_js_1=require("./CreateGroupByPosition.js"),CreateGroupBySolutions_js_1=require("./CreateGroupBySolutions.js"),MergeCause_js_1=require("./MergeCause.js"),MergeCode_js_1=require("./MergeCode.js"),MergeDescription_js_1=require("./MergeDescription.js"),MergeMoreInfo_js_1=require("./MergeMoreInfo.js"),MergePosition_js_1=require("./MergePosition.js"),MergeSolutions_js_1=require("./MergeSolutions.js");class MergeErrorList{constructor(e,r,o){this.hvigorLogList=e,this.mergeKey=r,this.option=this.handleOption(o),MergeErrorList.mergePropertyMap.set(ErrorLogConsts_js_1.MergeKeyEnum.CODE,new MergeCode_js_1.MergeCode),MergeErrorList.mergePropertyMap.set("description",new MergeDescription_js_1.MergeDescription),MergeErrorList.mergePropertyMap.set(ErrorLogConsts_js_1.MergeKeyEnum.CAUSE,new MergeCause_js_1.MergeCause),MergeErrorList.mergePropertyMap.set(ErrorLogConsts_js_1.MergeKeyEnum.POSITION,new MergePosition_js_1.MergePosition),MergeErrorList.mergePropertyMap.set(ErrorLogConsts_js_1.MergeKeyEnum.SOLUTIONS,new MergeSolutions_js_1.MergeSolutions),MergeErrorList.mergePropertyMap.set(ErrorLogConsts_js_1.MergeKeyEnum.MORE_INFO,new MergeMoreInfo_js_1.MergeMoreInfo),MergeErrorList.groupByKeyMap.set(ErrorLogConsts_js_1.MergeKeyEnum.CODE,new CreateGroupByCode_js_1.CreateGroupByCode),MergeErrorList.groupByKeyMap.set(ErrorLogConsts_js_1.MergeKeyEnum.CAUSE,new CreateGroupByCause_js_1.CreateGroupByCause),MergeErrorList.groupByKeyMap.set(ErrorLogConsts_js_1.MergeKeyEnum.POSITION,new CreateGroupByPosition_js_1.CreateGroupByPosition),MergeErrorList.groupByKeyMap.set(ErrorLogConsts_js_1.MergeKeyEnum.SOLUTIONS,new CreateGroupBySolutions_js_1.CreateGroupBySolutions),MergeErrorList.groupByKeyMap.set(ErrorLogConsts_js_1.MergeKeyEnum.MORE_INFO,new CreateGroupByMoreInfo_js_1.CreateGroupByMoreInfo)}getMergedErrorList(){const e=this.getGroupedErrors(this.mergeKey,this.option);let r=[];return e.forEach((e,o)=>{r.push(this.mergeErrors(e,this.option))}),r}getGroupedErrors(e,r){var o;const s=new Map;return null===(o=MergeErrorList.groupByKeyMap.get(this.mergeKey))||void 0===o||o.newGroupByKey(this.hvigorLogList).groupByKey(r,s),s}mergeErrors(e,r){let o=new HvigorErrorInfo_js_1.HvigorErrorInfo({code:e[0].getCode(),cause:e[0].getCause(),description:e[0].getDescription(),position:e[0].getPosition(),solutions:e[0].getSolutions(),moreInfo:e[0].getMoreInfo()});for(let s=1;s<e.length;s++){const t=e[s];o=this.mergeTwoErrors(o,t,r)}return o}mergeTwoErrors(e,r,o){const s=this.handleOption(o),t=new HvigorErrorInfo_js_1.HvigorErrorInfo;return MergeErrorList.mergePropertyMap.forEach((o,n)=>{const g=o.mergeTwoKey(e,r,s);t[n]=g}),t}handleOption(e){const r={code:ErrorLogConsts_js_1.MergeType.COLLECT_LAST,cause:ErrorLogConsts_js_1.MergeType.COLLECT_LAST,position:ErrorLogConsts_js_1.MergeType.COLLECT_LAST,solutions:ErrorLogConsts_js_1.MergeType.COLLECT_LAST,moreInfo:ErrorLogConsts_js_1.MergeType.COLLECT_LAST,compareCode:(e,r)=>e.getCode()===r.getCode(),compareCause:(e,r)=>e.getCause()===r.getCause(),comparePosition:(e,r)=>e.getPosition()===r.getPosition(),compareMoreInfo:(e,r)=>{var o,s,t,n;return!(!e||!r)&&((null===(o=e.getMoreInfo())||void 0===o?void 0:o.cn)==(null===(s=r.getMoreInfo())||void 0===s?void 0:s.cn)&&(null===(t=e.getMoreInfo())||void 0===t?void 0:t.en)==(null===(n=r.getMoreInfo())||void 0===n?void 0:n.en))},compareSolutions:(e,r)=>{if(!e||!r)return!1;const o=e.getSolutions().sort(),s=r.getSolutions().sort();return o.join()===s.join()}};return Object.assign(r,e)}}exports.MergeErrorList=MergeErrorList,MergeErrorList.mergePropertyMap=new Map,MergeErrorList.groupByKeyMap=new Map;